<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<title
	th:text="${usuario.id == null} ? 'Nuevo Usuario' : 'Editar Usuario'">Usuario</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
	rel="stylesheet">

<style>
body {
	background-color: #f4f6f9;
}

.card {
	border: none;
	border-radius: 15px;
	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.card-header {
	background: linear-gradient(90deg, #0d6efd, #0dcaf0);
	color: white;
	font-weight: bold;
	border-radius: 15px 15px 0 0;
}

label i {
	color: #0d6efd;
	margin-right: 5px;
}

.btn {
	border-radius: 10px;
}
/* Estilo para el feedback de error. Bootstrap lo maneja, pero es bueno saber qué hace. */
.form-control:invalid:not(:placeholder-shown),
.form-select:invalid:not(:placeholder-shown) {
    border-color: #dc3545; /* Rojo de Bootstrap */
    padding-right: calc(1.5em + 0.75rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}
</style>
</head>

<body class="container py-5">

	<div class="row justify-content-center">
		<div class="col-md-8 col-lg-6">
			<div class="card">
				<div class="card-header text-center">
					<i class="fa-solid fa-user-pen me-2"></i> <span
						th:text="${usuario.id == null} ? 'Registrar Nuevo Usuario' : 'Editar Usuario'"></span>
				</div>
				<div class="card-body">

					<form
						th:action="${usuario.id == null} ? @{/admin/usuarios} : @{/admin/usuarios/actualizar/{id}(id=${usuario.id})}"
						th:object="${usuario}" method="post" class="needs-validation"
						novalidate>

						<div class="mb-3">
							<label for="nombre" class="form-label"><i
								class="fa-solid fa-user"></i>Nombre</label> <input type="text"
								th:field="*{nombre}" class="form-control" id="nombre" required>
							<div class="invalid-feedback">Por favor, ingresa el nombre.</div>
						</div>

						<div class="mb-3">
							<label for="apellido" class="form-label"><i
								class="fa-solid fa-user-tag"></i>Apellido</label> <input type="text"
								th:field="*{apellido}" class="form-control" id="apellido"
								required>
							<div class="invalid-feedback">Por favor, ingresa el apellido.</div>
						</div>

						<div class="mb-3">
							<label for="email" class="form-label"><i
								class="fa-solid fa-envelope"></i>Email</label> <input type="email"
								th:field="*{email}" class="form-control" id="email" required>
							<div class="invalid-feedback">Por favor, ingresa un email
								válido.</div>
						</div>

						<div class="mb-3">
							<label for="password" class="form-label"><i
								class="fa-solid fa-lock"></i>Contraseña</label> <input
								type="password" th:field="*{password}" class="form-control"
								id="password" th:attrappend="required=${usuario.id == null}">
							<small th:if="${usuario.id != null}" class="text-muted">
								Si no deseas cambiar la contraseña, deja este campo vacío. </small>
							<div th:if="${usuario.id == null}" class="invalid-feedback">Por
								favor, ingresa una contraseña.</div>
						</div>

						<div class="mb-3">
							<label for="imagenUrl" class="form-label"><i
								class="fa-solid fa-image"></i>Imagen (URL)</label> <input type="url"
								th:field="*{imagenUrl}" class="form-control" id="imagenUrl"
								placeholder="https://...">
							</div>

						<div class="mb-3">
							<label for="rol" class="form-label"><i
								class="fa-solid fa-user-shield"></i>Rol</label> <select
								class="form-select" th:field="*{rol.id}" id="rol" required>
								<option value="">-- Selecciona un rol --</option>
								<option th:each="rol : ${roles}" th:value="${rol.id}"
									th:text="${rol.nombre}"
									th:selected="${usuario.rol != null and rol.id == usuario.rol.id}">
								</option>
							</select>
							<div class="invalid-feedback">Por favor, selecciona un rol.</div>
						</div>

						<div class="d-flex justify-content-between">
							<a th:href="@{/admin/usuarios}" class="btn btn-secondary"> <i
								class="fa-solid fa-arrow-left"></i> Cancelar
							</a>
							<button type="submit" class="btn btn-success">
								<i class="fa-solid fa-floppy-disk"></i> Guardar
							</button>
						</div>

					</form>
				</div>
			</div>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		(function() {
			'use strict'

			// Seleccionar todos los formularios a los que queremos aplicar estilos de validación personalizados de Bootstrap
			const forms = document.querySelectorAll('.needs-validation')

			// Iterar sobre ellos y prevenir el envío
			Array.from(forms).forEach(form => {
				form.addEventListener('submit', event => {
					if (!form.checkValidity()) {
						event.preventDefault()
						event.stopPropagation()
					}

					form.classList.add('was-validated')
				}, false)
			})
		})()
	</script>
</body>
</html>