<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mis Compras | Librer√≠a BookFlow</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
	rel="stylesheet"> 
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link
	href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
	rel="stylesheet">

<link rel="stylesheet" th:href="@{/Css/clientecompra.css}">
</head>
<body class="bg-light">

	<div class="container py-5">
		
		<div class="header-section mb-5">
			<h2 class="mb-3 mb-md-0 section-title">
				<i class="bi bi-bag-check-fill me-2"></i> Historial de Compras
			</h2>
			<div class="search-box">
				<input id="searchInput" type="text" class="form-control shadow-sm"
					placeholder="üîç Buscar por Fecha (dd/MM/yyyy)...">
			</div>
		</div>

		<div th:if="${#lists.isEmpty(compras)}" class="empty-message p-4 shadow-sm">
			<i class="bi bi-info-circle me-2"></i> Parece que a√∫n no has
			realizado ninguna compra en **BookFlow**. ¬°Es un buen momento para
			empezar!
		</div>

		<div th:if="${!#lists.isEmpty(compras)}" class="table-responsive">
			<table class="table table-hover align-middle table-striped table-compras shadow-sm">
				<thead>
					<tr>
						<th>ID</th>
						<th>Fecha</th>
						<th>M√©todo de Pago</th>
						<th class="text-end">Total</th>
						<th class="text-center">Acciones</th>
					</tr>
				</thead>
				<tbody id="comprasTable">
					<tr th:each="v : ${compras}">
						<td class="fw-bold text-primary" th:text="${v.id}">1001</td>
						<td th:text="${#temporals.format(v.fecha, 'dd/MM/yyyy HH:mm')}">15/10/2025
							09:45</td>
						<td th:text="${v.metodoPago}">Tarjeta</td>
						<td class="fw-bold text-success text-end"
							th:text="'S/ ' + ${#numbers.formatDecimal(v.total,1,'COMMA',2,'POINT')}">S/
							45.50</td>
						<td class="acciones-btn text-center">
                            <a th:href="@{/cliente/compra/{id}(id=${v.id})}"
                               class="btn btn-outline-info btn-sm me-2" data-bs-toggle="tooltip"
                               title="Ver detalles"> 
                                <i class="bi bi-eye"></i>
                            </a>
                           
                        </td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<div th:replace="fragments/cliente_footer :: footer"></div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<script>
        // Inicializaci√≥n de Tooltips de Bootstrap
        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        });
        
        // Buscador solo por Fecha (L√≥gica optimizada)
        document.getElementById("searchInput").addEventListener("keyup", function () {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll("#comprasTable tr");
            
            rows.forEach(row => {
                // √çndice 1 corresponde a la columna de Fecha en la tabla
                const dateCell = row.cells[1]; 
                if (dateCell) {
                    const dateText = dateCell.innerText.toLowerCase();
                    row.style.display = dateText.includes(filter) ? "" : "none";
                }
            });
        });

              
    </script>

</body>
</html>