<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo de Libros | BookFlow</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<link rel="stylesheet" th:href="@{/Css/clienteCatalogo.css}">
</head>
<body>

<div class="header-band py-3 mb-5">
 <div class="container d-flex justify-content-between align-items-center">
    <h1 class="h3 mb-0 text-white"><i class="fa-solid fa-book-open-reader me-2"></i>Catálogo BookFlow</h1>
    <div>
        <a th:href="@{/cliente/carrito}" class="btn btn-warning btn-lg shadow-sm me-2">
            <i class="fa-solid fa-cart-shopping me-2"></i>Ver Carrito
        </a>
      
    </div>
</div>

</div>

<div class="container">
    <h2 class="section-title mb-4 pb-2">Nuestros Libros Disponibles</h2>
    
    <div class="row g-4">
        <div th:if="${#lists.isEmpty(libros)}" class="col-12">
            <div class="alert alert-info text-center py-4">
                <i class="fa-solid fa-exclamation-circle me-2"></i>
                No hay libros disponibles en este momento.
            </div>
        </div>

        <div class="col-6 col-sm-4 col-md-3 col-lg-2" th:each="libro : ${libros}">
            <div class="book-card shadow-sm h-100 p-2">
                
                <figure class="book-img-container">
                    <img th:src="${libro.imagenUrl != null ? libro.imagenUrl : '/img/libro-default.jpg'}"
                         alt="Portada de libro: ${libro.titulo}" class="book-img">
                         
                    <span th:if="${libro.descuento > 0}" class="badge-descuento"
                          th:text="'-' + ${#numbers.formatDecimal(libro.descuento * 100, 0, 0)} + '%'">-15%</span>
                          
                    <div th:if="${libro.stock <= 0}" class="stock-overlay bg-danger text-white">AGOTADO</div>
                </figure>
                
                <div class="card-body p-2 text-center">
                    <p class="book-author small text-muted mb-0" th:text="${libro.autor.nombre}"></p>
                    <h6 class="book-title" th:text="${libro.titulo}"></h6>

                    <div class="price-section mb-2">
                        <span class="book-price fw-bold" th:text="'S/ ' + ${#numbers.formatDecimal(libro.getPrecioFinal(), 1, 2)}">S/ 19.99</span>
                        
                        <span th:if="${libro.descuento > 0}" class="book-old-price ms-1" 
                              th:text="'S/ ' + ${#numbers.formatDecimal(libro.precio, 1, 2)}">S/ 24.99</span>
                    </div>
                    
                    <p th:if="${libro.stock > 0}" class="stock-count fw-bold mb-2" 
                       th:classappend="${libro.stock <= 15 ? 'text-danger' : 'text-success'}">
                        Stock: <span th:text="${libro.stock}"></span>
                    </p>

                    <div th:if="${libro.stock > 0 and libro.stock <= 15}" 
                         class="alert alert-warning p-1 mb-2 stock-alert">
                        <small><i class="fa-solid fa-exclamation-triangle me-1"></i>¡Últimas unidades!</small>
                    </div>
                </div>

                <div class="card-footer p-2 border-0 bg-white">
                    <form th:if="${libro.stock > 0}" 
                          th:action="@{/carrito/agregar/{id}(id=${libro.id})}" 
                          method="post" class="d-flex justify-content-center align-items-center">
                          
                        <input type="number" name="cantidad" value="1" min="1" 
                               th:max="${libro.stock < 15 ? libro.stock : 15}"
                               class="form-control form-control-sm text-center me-2" style="width: 55px;">
                        
                        <button type="submit" class="btn btn-primary btn-sm btn-agregar flex-grow-1">
                            <i class="fa-solid fa-cart-plus me-1"></i>Añadir
                        </button>
                    </form>
                    
                    <button th:if="${libro.stock <= 0}" type="button" class="btn btn-danger btn-sm w-100" disabled>
                        AGOTADO
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
  	<div th:replace="fragments/cliente_footer :: footer"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>